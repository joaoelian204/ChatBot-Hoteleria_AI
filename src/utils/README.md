# üõ†Ô∏è M√≥dulo `utils/` - Utilidades del Sistema

## üìã Descripci√≥n General

El m√≥dulo `utils/` contiene herramientas auxiliares y utilidades que son utilizadas por todo el sistema del ChatBot de Hoteler√≠a. Este m√≥dulo proporciona funcionalidades comunes como logging, procesamiento de texto y utilidades espec√≠ficas del dominio hotelero.

## üèóÔ∏è Estructura del M√≥dulo

```
utils/
‚îú‚îÄ‚îÄ __init__.py              # üì¶ Inicializaci√≥n del m√≥dulo
‚îú‚îÄ‚îÄ logger.py                # üìù Sistema de logging centralizado
‚îú‚îÄ‚îÄ text_processor.py        # ‚úçÔ∏è Procesamiento y validaci√≥n de texto
‚îî‚îÄ‚îÄ hotel_utils.py           # üè® Utilidades espec√≠ficas del hotel
```

## üìÑ Documentaci√≥n por Archivo

### üìù `logger.py` - Sistema de Logging Centralizado

**Prop√≥sito**: Proporciona un sistema de logging unificado y configurable para todo el proyecto.

**Estructura**:
- **setup_logger()**: Funci√≥n principal para configurar loggers
- **Logger Global**: Instancia singleton del logger principal
- **Handlers M√∫ltiples**: Logging a consola y archivo
- **Configuraci√≥n Centralizada**: Uso de settings del sistema

**Funcionalidades**:
- ‚úÖ Configuraci√≥n autom√°tica de loggers
- ‚úÖ Logging simult√°neo a consola y archivo
- ‚úÖ Formato personalizable de mensajes
- ‚úÖ Niveles de log configurables
- ‚úÖ Creaci√≥n autom√°tica de directorio de logs
- ‚úÖ Codificaci√≥n UTF-8 para caracteres especiales
- ‚úÖ Prevenci√≥n de configuraci√≥n m√∫ltiple
- ‚úÖ Logger global accesible desde cualquier m√≥dulo

**Estructura de Configuraci√≥n**:
```python
def setup_logger(name: str = None) -> logging.Logger:
    # Configuraci√≥n de nivel de log
    logger.setLevel(getattr(logging, settings.LOG_LEVEL))
    
    # Formato de mensajes
    formatter = logging.Formatter(settings.LOG_FORMAT)
    
    # Handler para consola
    console_handler = logging.StreamHandler()
    
    # Handler para archivo
    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    
    return logger
```

**Uso**:
```python
from utils.logger import logger

# Logging b√°sico
logger.info("‚úÖ Sistema iniciado correctamente")
logger.warning("‚ö†Ô∏è Configuraci√≥n no encontrada")
logger.error("‚ùå Error en el procesamiento")
logger.debug("üîç Informaci√≥n de debug")

# Logger espec√≠fico para un m√≥dulo
from utils.logger import setup_logger
module_logger = setup_logger('mi_modulo')
module_logger.info("Mensaje espec√≠fico del m√≥dulo")
```

**Configuraci√≥n**:
- **LOG_LEVEL**: Nivel de logging (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- **LOG_FORMAT**: Formato de mensajes con timestamp y nivel
- **Archivo de Log**: `logs/bot.log` en la ra√≠z del proyecto
- **Codificaci√≥n**: UTF-8 para soporte de caracteres especiales

**Dependencias**:
- `logging`: M√≥dulo est√°ndar de Python
- `config.settings`: Configuraci√≥n del sistema
- `pathlib`: Manejo de rutas de archivos

---

### ‚úçÔ∏è `text_processor.py` - Procesamiento y Validaci√≥n de Texto

**Prop√≥sito**: Proporciona funciones para procesar, validar y sanitizar texto de entrada de usuarios.

**Estructura**:
- **sanitize_text()**: Limpieza y normalizaci√≥n de texto
- **validate_message()**: Validaci√≥n de mensajes de usuarios
- **normalize_text()**: Normalizaci√≥n de formato
- **extract_keywords()**: Extracci√≥n de palabras clave
- **clean_html()**: Limpieza de HTML y formato

**Funcionalidades**:
- ‚úÖ Sanitizaci√≥n de texto de entrada
- ‚úÖ Validaci√≥n de longitud y contenido
- ‚úÖ Normalizaci√≥n de caracteres especiales
- ‚úÖ Eliminaci√≥n de HTML y formato no deseado
- ‚úÖ Extracci√≥n de palabras clave relevantes
- ‚úÖ Detecci√≥n de spam y contenido inapropiado
- ‚úÖ Normalizaci√≥n de espacios y puntuaci√≥n
- ‚úÖ Validaci√≥n de caracteres permitidos

**Funciones Principales**:

#### `sanitize_text(text: str) -> str`
- **Prop√≥sito**: Limpia y normaliza texto de entrada
- **Funcionalidad**:
  - Elimina caracteres especiales no deseados
  - Normaliza espacios m√∫ltiples
  - Convierte a min√∫sculas si es necesario
  - Elimina HTML y formato
  - Retorna texto limpio y normalizado

#### `validate_message(text: str, max_length: int = 1000) -> bool`
- **Prop√≥sito**: Valida que un mensaje cumpla con los requisitos
- **Funcionalidad**:
  - Verifica longitud m√°xima
  - Valida caracteres permitidos
  - Detecta contenido inapropiado
  - Verifica que no est√© vac√≠o
  - Retorna True si es v√°lido

#### `normalize_text(text: str) -> str`
- **Prop√≥sito**: Normaliza el formato del texto
- **Funcionalidad**:
  - Normaliza espacios y saltos de l√≠nea
  - Corrige puntuaci√≥n
  - Elimina caracteres de control
  - Mantiene estructura legible

#### `extract_keywords(text: str) -> List[str]`
- **Prop√≥sito**: Extrae palabras clave relevantes
- **Funcionalidad**:
  - Identifica palabras importantes
  - Filtra palabras comunes (stop words)
  - Retorna lista de palabras clave
  - √ötil para b√∫squedas y an√°lisis

**Uso**:
```python
from utils.text_processor import sanitize_text, validate_message

# Sanitizar texto de entrada
clean_text = sanitize_text("  Hola! ¬øQu√©   habitaciones   tienen?  ")
# Resultado: "Hola! ¬øQu√© habitaciones tienen?"

# Validar mensaje
is_valid = validate_message("Consulta sobre habitaciones", max_length=100)
# Resultado: True

# Normalizar texto
normalized = normalize_text("texto\ncon\nsaltos\nde\nl√≠nea")
# Resultado: "texto con saltos de l√≠nea"
```

**Dependencias**:
- `re`: Expresiones regulares
- `html`: Procesamiento de HTML
- `unicodedata`: Normalizaci√≥n Unicode

---

### üè® `hotel_utils.py` - Utilidades Espec√≠ficas del Hotel

**Prop√≥sito**: Contiene funciones espec√≠ficas del dominio hotelero para procesar informaci√≥n relacionada con hoteles, habitaciones, servicios y reservas.

**Estructura**:
- **parse_room_info()**: An√°lisis de informaci√≥n de habitaciones
- **extract_prices()**: Extracci√≥n de precios de texto
- **validate_dates()**: Validaci√≥n de fechas de reserva
- **format_currency()**: Formateo de moneda
- **parse_amenities()**: An√°lisis de amenidades
- **validate_contact()**: Validaci√≥n de informaci√≥n de contacto

**Funcionalidades**:
- ‚úÖ An√°lisis de informaci√≥n de habitaciones
- ‚úÖ Extracci√≥n y validaci√≥n de precios
- ‚úÖ Validaci√≥n de fechas de reserva
- ‚úÖ Formateo de moneda y precios
- ‚úÖ An√°lisis de amenidades y servicios
- ‚úÖ Validaci√≥n de informaci√≥n de contacto
- ‚úÖ Conversi√≥n de unidades (moneda, tiempo)
- ‚úÖ Generaci√≥n de res√∫menes de servicios

**Funciones Principales**:

#### `parse_room_info(text: str) -> dict`
- **Prop√≥sito**: Extrae informaci√≥n estructurada de habitaciones
- **Funcionalidad**:
  - Identifica tipo de habitaci√≥n
  - Extrae capacidad y caracter√≠sticas
  - Detecta precios y disponibilidad
  - Retorna diccionario estructurado

#### `extract_prices(text: str) -> List[float]`
- **Prop√≥sito**: Extrae precios de texto
- **Funcionalidad**:
  - Identifica patrones de precios
  - Maneja diferentes formatos de moneda
  - Convierte a valores num√©ricos
  - Retorna lista de precios encontrados

#### `validate_dates(date_text: str) -> bool`
- **Prop√≥sito**: Valida fechas de reserva
- **Funcionalidad**:
  - Verifica formato de fecha
  - Valida que sea fecha futura
  - Comprueba disponibilidad de rango
  - Retorna True si es v√°lida

#### `format_currency(amount: float, currency: str = "USD") -> str`
- **Prop√≥sito**: Formatea cantidades monetarias
- **Funcionalidad**:
  - Aplica formato de moneda
  - Maneja diferentes divisas
  - Incluye s√≠mbolos de moneda
  - Retorna string formateado

#### `parse_amenities(text: str) -> List[str]`
- **Prop√≥sito**: Extrae lista de amenidades
- **Funcionalidad**:
  - Identifica servicios mencionados
  - Categoriza amenidades
  - Normaliza nombres
  - Retorna lista estructurada

#### `validate_contact(contact_info: str) -> bool`
- **Prop√≥sito**: Valida informaci√≥n de contacto
- **Funcionalidad**:
  - Verifica formato de email
  - Valida n√∫meros de tel√©fono
  - Comprueba direcciones
  - Retorna True si es v√°lida

**Uso**:
```python
from utils.hotel_utils import parse_room_info, extract_prices, format_currency

# Analizar informaci√≥n de habitaci√≥n
room_info = parse_room_info("Suite de lujo con vista al mar, 2 personas, $200/noche")
# Resultado: {
#     'type': 'Suite de lujo',
#     'capacity': 2,
#     'view': 'mar',
#     'price': 200,
#     'currency': 'USD'
# }

# Extraer precios
prices = extract_prices("Habitaci√≥n desde $150 hasta $300 por noche")
# Resultado: [150.0, 300.0]

# Formatear moneda
formatted = format_currency(250.50, "USD")
# Resultado: "$250.50"
```

**Dependencias**:
- `re`: Expresiones regulares
- `datetime`: Manejo de fechas
- `locale`: Formateo de moneda

---

## üîß Caracter√≠sticas del M√≥dulo

### üéØ Reutilizaci√≥n
- **Funciones Comunes**: Utilidades utilizadas por m√∫ltiples m√≥dulos
- **Interfaces Consistentes**: APIs uniformes para funcionalidades similares
- **Configuraci√≥n Centralizada**: Uso de settings del sistema
- **Documentaci√≥n Clara**: Cada funci√≥n tiene su prop√≥sito documentado

### üîí Robustez
- **Validaci√≥n de Entrada**: Verificaci√≥n de datos de entrada
- **Manejo de Errores**: Gesti√≥n de casos edge
- **Sanitizaci√≥n**: Limpieza de datos no confiables
- **Fallbacks**: Valores por defecto para casos de error

### ‚ö° Rendimiento
- **Funciones Optimizadas**: C√≥digo eficiente para operaciones comunes
- **Cache Interno**: Almacenamiento temporal de resultados
- **Lazy Loading**: Carga bajo demanda de recursos pesados
- **Procesamiento Batch**: Operaciones en lotes cuando es posible

### üìä Monitoreo
- **Logging Detallado**: Registro de operaciones importantes
- **M√©tricas de Uso**: Seguimiento de funciones m√°s utilizadas
- **Debugging**: Informaci√≥n detallada para desarrollo
- **Auditor√≠a**: Registro de cambios y operaciones cr√≠ticas

## üöÄ Configuraci√≥n del Sistema

### Variables de Entorno Relacionadas
```bash
# Configuraci√≥n de Logging
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# Configuraci√≥n de Procesamiento de Texto
MAX_MESSAGE_LENGTH=1000
ENABLE_TEXT_SANITIZATION=true
ENABLE_SPAM_DETECTION=true

# Configuraci√≥n de Hotel
DEFAULT_CURRENCY=USD
DEFAULT_TIMEZONE=UTC
ENABLE_DATE_VALIDATION=true
```

### Configuraci√≥n por Entorno

#### Desarrollo
```bash
LOG_LEVEL=DEBUG
ENABLE_TEXT_SANITIZATION=false
ENABLE_SPAM_DETECTION=false
```

#### Producci√≥n
```bash
LOG_LEVEL=WARNING
ENABLE_TEXT_SANITIZATION=true
ENABLE_SPAM_DETECTION=true
```

## üìÅ Estructura de Archivos

```
proyecto/
‚îú‚îÄ‚îÄ logs/                    # üìù Archivos de log
‚îÇ   ‚îî‚îÄ‚îÄ bot.log
‚îú‚îÄ‚îÄ utils/                   # üõ†Ô∏è M√≥dulo de utilidades
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ text_processor.py
‚îÇ   ‚îî‚îÄ‚îÄ hotel_utils.py
‚îî‚îÄ‚îÄ .env                     # üîê Variables de entorno
```

## üöÄ Inicio R√°pido

```python
# Importar utilidades principales
from utils.logger import logger
from utils.text_processor import sanitize_text, validate_message
from utils.hotel_utils import parse_room_info, format_currency

# Configurar logging
logger.info("üõ†Ô∏è Utilidades inicializadas")

# Procesar texto de usuario
user_input = "  Hola! ¬øQu√©   habitaciones   tienen?  "
clean_input = sanitize_text(user_input)

if validate_message(clean_input):
    logger.info(f"‚úÖ Mensaje v√°lido: {clean_input}")
else:
    logger.warning("‚ö†Ô∏è Mensaje inv√°lido")
```

## üìù Notas de Desarrollo

- **Logging**: Usar el logger centralizado para todas las operaciones
- **Validaci√≥n**: Siempre validar entrada antes de procesar
- **Sanitizaci√≥n**: Limpiar texto de usuarios antes de usar
- **Testing**: Cada funci√≥n tiene pruebas unitarias
- **Documentaci√≥n**: Mantener docstrings actualizados
- **Performance**: Optimizar funciones frecuentemente utilizadas 